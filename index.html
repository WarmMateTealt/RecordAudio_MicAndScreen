<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>replit</title>
  <link href="style.css" rel="stylesheet" type="text/css" />
</head>

<body>
  <p>
    This example shows you the contents of the selected part of your display.
    Click the Start Capture button to begin.
  </p>

  <p>
    <button id="start">Start Capture</button>&nbsp;<button id="stop">
      Stop Capture
    </button>
  </p>

  <iframe width="560" height="315" src="https://www.youtube.com/embed/Na0w3Mz46GA?si=jEysFGmOO1jFk6or" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

  <strong>Log:</strong>
  <br />
  <pre id="log"></pre>

  <audio id="recording" controls></audio> <!--esse pra ver o Ã¡udio-->
  <a id="downloadButton" class="button">Download</a>

  
</body>

</html>

<script type="module">
  import { startCapture, stopCapture } from "./audioRecordModule.js";
  
  const startElem = document.getElementById("start");
  const stopElem = document.getElementById("stop");
  const recordingElem = document.getElementById("recording");
  var fileRef;
  var file;
  
  // Set event listeners for the start and stop buttons
  startElem.addEventListener(
    "click",
    async (evt) => {
      console.log("click");
      file = await startCapture();
      fileRef = URL.createObjectURL(file);
      console.log("received blob url:" + fileRef);
      recording.src = fileRef;
      downloadButton.href = recording.src;
      downloadButton.download = "RecordedAudio.webm";

      // Fetch API request
      const url = "http://localhost:4000/api/upload";
      const formData = new FormData();
      formData.append("file", file);
      
      fetch(url, {
        method: 'POST',
        body: formData,
        headers: {
          "x-api-key": "132657ef-f954-4114-a0a7-1c5bec6d068d"
        }
      }).then(response => response.json())
        .then(data => console.log(data))
        .catch(error => console.error(error));
        
    },
    false,
  );

  stopElem.addEventListener(
    "click",
    (evt) => {
      stopCapture();
    },
    false,
  );
</script>